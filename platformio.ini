[env:attiny402]
platform = atmelmegaavr@1.9.0
board = attiny402

; Clock configuration - Use default: 20MHz osc with /6 prescaler = 3.33MHz
board_build.f_cpu = 3333333L

; Fuse configuration - Set OSCCFG to 20MHz
board_fuses.OSCCFG = 0x02

; Build sensor firmware with FDC1004 and UART logging
build_src_filter =
    -<*>
    +<main.cpp>
    +<power.cpp>
    +<rtc.cpp>
    +<button.cpp>
    +<buzzer.cpp>
    +<twi.cpp>
    +<fdc1004.cpp>
    +<log_updi_tx.cpp>


; Compiler flags for size optimization
build_flags =
    -Os                    ; Optimize for size
    -flto                  ; Link-time optimization
    -ffunction-sections    ; Each function in its own section
    -fdata-sections        ; Each data in its own section
    -Wall                  ; All warnings
    -Wextra                ; Extra warnings
    -fno-exceptions        ; No C++ exceptions
    -fno-rtti              ; No runtime type info
    -fno-threadsafe-statics ; No thread-safe statics
    -Wl,--gc-sections      ; Garbage collect unused sections
    -Wl,--relax            ; Linker relaxation
    -mcall-prologues       ; Use call prologues for function entry/exit
    ; UART timing calibration - uncomment and try different values if gibberish
    ; -DBIT_DELAY_LOOPS_OVERRIDE=84  ; default
    ; -DBIT_DELAY_LOOPS_OVERRIDE=80  ; faster
    ; -DBIT_DELAY_LOOPS_OVERRIDE=87  ; slower

; Linker flags
build_unflags =
    -fno-lto

extra_scripts =

; Upload configuration for UPDI
upload_protocol = serialupdi
upload_speed = 57600
upload_flags =
    -B 10

; Monitor (if available)
monitor_speed = 9600

; Dependencies
lib_deps =

